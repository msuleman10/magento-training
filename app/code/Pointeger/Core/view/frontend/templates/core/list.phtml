<?php
/**
 * @var Template $block ;
 */

use Magento\Framework\View\Element\Template;

?>
<div id="allComments">

</div>
<script>
    require(["jquery", "mage/url"], function ($, url) {
        $(document).ready(function () {
            function loadTable() {
                $.ajax({
                    url: "<?= $block->getUrl("core/comment/commentData")?>",
                    type: "GET",
                    error: function (error) {
                        console.log(error)
                    },
                    success: function (data) {
                        let commentData = JSON.parse(data.result);
                        let getFormUrl = url.build("core/comment/form");
                        if (commentData.length === 0) {
                            $("#allComments").html(`<h3>Opps you have no comments <i><u><a href="${getFormUrl}">add new
                            comments here</a></u></i></h3>`);
                        } else {
                            var table = $(` <table border="2px" class="table">
                                <thead>
                                <tr>
                                    <th>Entity Id</th>
                                    <th>Name</th>
                                    <th>Comment</th>
                                    <th>Delete</th>
                                </tr>
                                </thead>
                                <tbody> </tbody>`);
                            commentData.forEach((comment) => {
                                var row = $('<tr>').addClass('customer-data').addClass(comment.entity_id);
                                let trEntiryId = $('<td>').html(comment.entity_id);
                                let trName = $('<td>').html(comment.name);
                                let trComment = $('<td>').html(comment.comment);
                                let trButton = $('<td>').html(`<button data-name="test" data-id="${comment.entity_id}"class="button">Delete </button>`)
                                row.append(trEntiryId);
                                row.append(trName);
                                row.append(trComment);
                                row.append(trButton);
                                table.find('tbody').append(row);
                            })

                            $("#allComments").html(table);
                        }
                    }
                })
            }

            loadTable()

            $(document).on("click", ".button", function (e) {
                $.ajax({
                    url: "<?= $block->getUrl("core/comment/ajaxdelete")?>",
                    type: "POST",
                    data: {id: e.target.dataset.id},
                    error: function (error) {
                        console.log(error)
                    },
                    success: function () {
                        loadTable()
                    }
                })
            })
        })
    });
</script>
